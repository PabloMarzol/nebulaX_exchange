import { HyperliquidError } from "../../../_base.js";
/** Thrown when Exchange API returns an error response (e.g., insufficient funds). */
export class ApiRequestError extends HyperliquidError {
    response;
    constructor(response) {
        let message;
        if (response.status === "err") {
            // ErrorResponse
            message = response.response;
        }
        else {
            if ("statuses" in response.response.data) {
                // OrderResponse | CancelResponse
                const errors = response.response.data.statuses.reduce((acc, status, index) => {
                    if (typeof status === "object" && "error" in status) {
                        acc.push(`Order ${index}: ${status.error}`);
                    }
                    return acc;
                }, []);
                if (errors.length > 0) {
                    message = errors.join(", ");
                }
            }
            else {
                // TwapOrderResponse | TwapCancelResponse
                if (typeof response.response.data.status === "object" && "error" in response.response.data.status) {
                    message = response.response.data.status.error;
                }
            }
        }
        super(message || "An unknown error occurred while processing an API request. See `response` for more details.");
        this.name = "ApiRequestError";
        this.response = response;
    }
}
export function assertSuccessResponse(response) {
    if (response.status === "err") {
        throw new ApiRequestError(response);
    }
    else if (response.response.type === "order" || response.response.type === "cancel") {
        if (response.response.data.statuses.some((status) => typeof status === "object" && "error" in status)) {
            throw new ApiRequestError(response);
        }
    }
    else if (response.response.type === "twapOrder" || response.response.type === "twapCancel") {
        if (typeof response.response.data.status === "object" && "error" in response.response.data.status) {
            throw new ApiRequestError(response);
        }
    }
}
//# sourceMappingURL=_errors.js.map